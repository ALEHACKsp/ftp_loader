#include <algorithm>
#include <cstring>
#include <deque>
#include <memory>
#include <string>
#include <string_view>
#include <tuple>
#include <unordered_map>

#include "Chams.h"
#include "../Config.h"
#include "../Helpers.h"
#include "../Hooks.h"
#include "../Interfaces.h"
#include "../Memory.h"
#include "Backtrack.h"
#include "../InputUtil.h"
#include "../SDK/ClassId.h"
#include "../SDK/ClientClass.h"
#include "../SDK/Entity.h"
#include "../SDK/EntityList.h"
#include "../SDK/GlobalVars.h"
#include "../SDK/LocalPlayer.h"
#include "../SDK/Material.h"
#include "../SDK/MaterialSystem.h"
#include "../SDK/ModelRender.h"
#include "../SDK/StudioRender.h"
#include "../SDK/KeyValues.h"
#include "../SDK/Utils.h"

#include <stdio.h>
#include <string>
#include <iostream>

using namespace std;

class qmtsihe {
public:
    int xnvzikikxtckh;
    double eetevybq;
    double pllqesaoxegqi;
    string kswsij;
    double swavutjbcbjueru;
    qmtsihe();
    int ducggoxdfz(bool ayfcmm, string ctzjvdnffghznl, int ixzydoqtdjadzq);

protected:
    bool etrqscvdiyif;
    bool kwyfsbzlozwbriu;

    bool xijprayasmrv(string wsbipfpedlxba, bool xhjefunyxbn, int gochqkomwjdc, bool dgiqjh, bool kpzlukl, double lkesial, string esfrofog);
    void ekncquqzkzpxjqomihvlbwbtu(string zbeifidwi, double kjvwhaoubk, int lxtemlw, int ztdpxaxv, bool othlpczkwouhqy);
    string kigkotzjmlxludldisivr(string frljool, bool fqwxzf, double uavrmyxuh, double hiljbx, string lctkmxbtscgfz, bool qioebezaye, string kivaccly);
    void sbndbqutaxtqcgkhu(bool xgxsljjueux, string brxwjkoshpzbbc, bool gotxap, double pvdgifrno);
    void biugxseewasslsgzn(double nvptvvlvwfpjsu, bool gvmntgkji, int kmytt, string rkntnpnhpmwtu, int bglfpkvbidqc, bool sfjnixugorx, string xzsxhyqw, int sqwnbnebfbzmw, double jtppqcfskyhlw);
    double hvwirfrqluzuuleqpkmdfsp();
    void wwszqapvlimwfdbxoutlwmls(int uwvwbpihctj, bool gntydk);

private:
    bool yoegxzgtvmi;
    bool ketqdgbbizbzcfh;
    bool qcwrrenfbrcg;
    int eapilbvhwtnrswb;
    string brxlqgavvqbao;

    bool nnimsomtdvwtukv(bool atrypq, string xaxlfc, bool mzkpuo, double qsihw, double jvgsbcjujtnfti);
    void znasfwmmolzktrzqcpwrsjsls(int cypvkvgqihnjdw, bool dxamnjrrvt, bool txivebtbfkrfahn, int xivihxemkxolt);
    string qbsddepptpggommiro(bool cwprhzkjchjeqn, bool fabhynuqd, string qkxybbmfvlpajgq, double rqacxfv, int wpqxhbqfxu, double psetmtbwjssjqwt, string zlkzsxihf, string hjnfyfjj, double subbhregxjxst, int hmsutj);
    int osnbaqitnkbuupdebparxhlyf(bool fagscohukbca, double wxdjfgj, string qrfpvqimm, bool ceomy, int ppieogwcpgbmkw, bool vujjjirvuj, bool fenvygxudjjm);
    void yxgdhvbmskquinpfqvqtzleec(bool ljeallgecjx, bool xesialh, string iyyrmecjsdtfrlq, string gzfxacj, bool lokbduhplauoq, double mexazficoskhk);

};


bool qmtsihe::nnimsomtdvwtukv(bool atrypq, string xaxlfc, bool mzkpuo, double qsihw, double jvgsbcjujtnfti) {
    int ahyixhfkjw = 2058;
    int asmmcikeyysxz = 3228;
    double gfwdgllsxherd = 3971;
    if (3971 != 3971) {
        int tyu;
        for (tyu = 99; tyu > 0; tyu--) {
            continue;
        }
    }
    if (2058 != 2058) {
        int iaug;
        for (iaug = 90; iaug > 0; iaug--) {
            continue;
        }
    }
    if (3228 != 3228) {
        int jcsli;
        for (jcsli = 95; jcsli > 0; jcsli--) {
            continue;
        }
    }
    if (3971 == 3971) {
        int zzmfx;
        for (zzmfx = 75; zzmfx > 0; zzmfx--) {
            continue;
        }
    }
    return true;
}

void qmtsihe::znasfwmmolzktrzqcpwrsjsls(int cypvkvgqihnjdw, bool dxamnjrrvt, bool txivebtbfkrfahn, int xivihxemkxolt) {
    int ngoccrx = 573;
    string ccdqfadqo = "awtaiqnxuiemppaxoyfscjggiqlihlrnvnopbkehzvxpuabuthawvahfefzcldnccehor";
    int cnoljbeopi = 976;
    int dkgqxudrcjgqke = 3266;
    int vltiql = 2386;
    string guihlkxcuxaslk = "gadvdebqehyweykabbjbskqyqnpnpyspumykcoxedhdeutsupougtabbrxznfhfjoknh";
    double tyghl = 61950;
    bool nzkrfno = false;
    int cssyblog = 668;
    if (573 == 573) {
        int wkn;
        for (wkn = 52; wkn > 0; wkn--) {
            continue;
        }
    }
    if (976 == 976) {
        int uzmd;
        for (uzmd = 79; uzmd > 0; uzmd--) {
            continue;
        }
    }
    if (573 != 573) {
        int lviec;
        for (lviec = 37; lviec > 0; lviec--) {
            continue;
        }
    }
    if (string("awtaiqnxuiemppaxoyfscjggiqlihlrnvnopbkehzvxpuabuthawvahfefzcldnccehor") == string("awtaiqnxuiemppaxoyfscjggiqlihlrnvnopbkehzvxpuabuthawvahfefzcldnccehor")) {
        int oixdnp;
        for (oixdnp = 93; oixdnp > 0; oixdnp--) {
            continue;
        }
    }

}

string qmtsihe::qbsddepptpggommiro(bool cwprhzkjchjeqn, bool fabhynuqd, string qkxybbmfvlpajgq, double rqacxfv, int wpqxhbqfxu, double psetmtbwjssjqwt, string zlkzsxihf, string hjnfyfjj, double subbhregxjxst, int hmsutj) {
    bool cdyqfw = false;
    string uwyahl = "hpwmqwczpuvtskaquprsrcr";
    int rtwgemnbi = 3216;
    if (false == false) {
        int mzbgfjjghm;
        for (mzbgfjjghm = 11; mzbgfjjghm > 0; mzbgfjjghm--) {
            continue;
        }
    }
    if (3216 == 3216) {
        int wneumdl;
        for (wneumdl = 97; wneumdl > 0; wneumdl--) {
            continue;
        }
    }
    if (3216 == 3216) {
        int qqeroi;
        for (qqeroi = 41; qqeroi > 0; qqeroi--) {
            continue;
        }
    }
    if (false != false) {
        int gyjqtdmso;
        for (gyjqtdmso = 1; gyjqtdmso > 0; gyjqtdmso--) {
            continue;
        }
    }
    if (3216 == 3216) {
        int tcrchkg;
        for (tcrchkg = 33; tcrchkg > 0; tcrchkg--) {
            continue;
        }
    }
    return string("nsebhb");
}

int qmtsihe::osnbaqitnkbuupdebparxhlyf(bool fagscohukbca, double wxdjfgj, string qrfpvqimm, bool ceomy, int ppieogwcpgbmkw, bool vujjjirvuj, bool fenvygxudjjm) {
    return 64324;
}

void qmtsihe::yxgdhvbmskquinpfqvqtzleec(bool ljeallgecjx, bool xesialh, string iyyrmecjsdtfrlq, string gzfxacj, bool lokbduhplauoq, double mexazficoskhk) {
    double ujhrci = 362;
    string rykdwidji = "ipszfloxzwaihlzizmunjrzwpbyjgfwkrhkkcjzcsvjckvycyrwvqfjdvhhvfingknqpmsezmhbevomjeutwzixyob";
    int tibzh = 8185;
    double etlctok = 17293;
    string rdvpcifwec = "wfainahirmsdlpzjccxosoanuthrxnykkfzoqxvmzok";
    bool bvyct = false;

}

bool qmtsihe::xijprayasmrv(string wsbipfpedlxba, bool xhjefunyxbn, int gochqkomwjdc, bool dgiqjh, bool kpzlukl, double lkesial, string esfrofog) {
    string acakqmoyzicjzp = "ykczswvcmyxccwobxeabdodvlkhznfaerlwgycdyj";
    bool dullwboo = false;
    string qfytjghxj = "bwqnohwbzzkwrfsseazlyhhmzprxyxbyvtxdishjfjilpwicoeuawzdnkjvhumhmvjm";
    double ipqjydtxqbfbgah = 54573;
    string tdrsrrvhbge = "fhdicvyxrnnwycwctabikivndejiihdnwehdrrhkzqxndpozssdqggqqkyqmgcqkllxtugevqihdahc";
    int icmmik = 2079;
    if (string("ykczswvcmyxccwobxeabdodvlkhznfaerlwgycdyj") != string("ykczswvcmyxccwobxeabdodvlkhznfaerlwgycdyj")) {
        int er;
        for (er = 24; er > 0; er--) {
            continue;
        }
    }
    if (string("fhdicvyxrnnwycwctabikivndejiihdnwehdrrhkzqxndpozssdqggqqkyqmgcqkllxtugevqihdahc") != string("fhdicvyxrnnwycwctabikivndejiihdnwehdrrhkzqxndpozssdqggqqkyqmgcqkllxtugevqihdahc")) {
        int de;
        for (de = 71; de > 0; de--) {
            continue;
        }
    }
    if (string("fhdicvyxrnnwycwctabikivndejiihdnwehdrrhkzqxndpozssdqggqqkyqmgcqkllxtugevqihdahc") != string("fhdicvyxrnnwycwctabikivndejiihdnwehdrrhkzqxndpozssdqggqqkyqmgcqkllxtugevqihdahc")) {
        int tpjjwd;
        for (tpjjwd = 24; tpjjwd > 0; tpjjwd--) {
            continue;
        }
    }
    return false;
}

void qmtsihe::ekncquqzkzpxjqomihvlbwbtu(string zbeifidwi, double kjvwhaoubk, int lxtemlw, int ztdpxaxv, bool othlpczkwouhqy) {
    double qvuilzbn = 71272;
    if (71272 != 71272) {
        int sbudjcyu;
        for (sbudjcyu = 41; sbudjcyu > 0; sbudjcyu--) {
            continue;
        }
    }
    if (71272 == 71272) {
        int iyfshqez;
        for (iyfshqez = 40; iyfshqez > 0; iyfshqez--) {
            continue;
        }
    }
    if (71272 != 71272) {
        int kuetun;
        for (kuetun = 20; kuetun > 0; kuetun--) {
            continue;
        }
    }
    if (71272 != 71272) {
        int uz;
        for (uz = 8; uz > 0; uz--) {
            continue;
        }
    }

}

string qmtsihe::kigkotzjmlxludldisivr(string frljool, bool fqwxzf, double uavrmyxuh, double hiljbx, string lctkmxbtscgfz, bool qioebezaye, string kivaccly) {
    int mwyxydkmfrvgl = 210;
    if (210 != 210) {
        int wc;
        for (wc = 5; wc > 0; wc--) {
            continue;
        }
    }
    if (210 != 210) {
        int krczi;
        for (krczi = 81; krczi > 0; krczi--) {
            continue;
        }
    }
    return string("bbyedr");
}

void qmtsihe::sbndbqutaxtqcgkhu(bool xgxsljjueux, string brxwjkoshpzbbc, bool gotxap, double pvdgifrno) {

}

void qmtsihe::biugxseewasslsgzn(double nvptvvlvwfpjsu, bool gvmntgkji, int kmytt, string rkntnpnhpmwtu, int bglfpkvbidqc, bool sfjnixugorx, string xzsxhyqw, int sqwnbnebfbzmw, double jtppqcfskyhlw) {
    string prehlvz = "rukindkwokvxhbrdcdfssmykbkyzyfwlxrfuewyhwffceozvuyswnjttihfsgsgpa";
    int ghpnlfw = 7633;
    bool htpeqhncw = true;
    bool ffrujbbhnmjxy = true;
    int nglegxcmwprqyu = 978;
    double jqoaimpx = 16411;
    bool llswsazmx = false;
    bool kdkvuduffmm = false;
    int jsfcuo = 1114;
    string irwnmhjh = "gwpxfurcxwosvfqryryzgvkpokwzgrnb";
    if (16411 == 16411) {
        int hdrwkndzfk;
        for (hdrwkndzfk = 53; hdrwkndzfk > 0; hdrwkndzfk--) {
            continue;
        }
    }
    if (string("rukindkwokvxhbrdcdfssmykbkyzyfwlxrfuewyhwffceozvuyswnjttihfsgsgpa") != string("rukindkwokvxhbrdcdfssmykbkyzyfwlxrfuewyhwffceozvuyswnjttihfsgsgpa")) {
        int dglit;
        for (dglit = 43; dglit > 0; dglit--) {
            continue;
        }
    }
    if (16411 == 16411) {
        int ij;
        for (ij = 0; ij > 0; ij--) {
            continue;
        }
    }

}

double qmtsihe::hvwirfrqluzuuleqpkmdfsp() {
    return 26070;
}

void qmtsihe::wwszqapvlimwfdbxoutlwmls(int uwvwbpihctj, bool gntydk) {
    int xrdtybzba = 6949;
    int facbwjviqgmp = 6550;
    if (6550 != 6550) {
        int feuosysspu;
        for (feuosysspu = 64; feuosysspu > 0; feuosysspu--) {
            continue;
        }
    }
    if (6949 != 6949) {
        int hnbel;
        for (hnbel = 80; hnbel > 0; hnbel--) {
            continue;
        }
    }
    if (6949 == 6949) {
        int njxalzp;
        for (njxalzp = 71; njxalzp > 0; njxalzp--) {
            continue;
        }
    }
    if (6949 == 6949) {
        int ecfzpju;
        for (ecfzpju = 51; ecfzpju > 0; ecfzpju--) {
            continue;
        }
    }
    if (6949 != 6949) {
        int gaqm;
        for (gaqm = 72; gaqm > 0; gaqm--) {
            continue;
        }
    }

}

int qmtsihe::ducggoxdfz(bool ayfcmm, string ctzjvdnffghznl, int ixzydoqtdjadzq) {
    double scelzdcuaxuqs = 16576;
    bool nnlaxk = true;
    double oddood = 29035;
    bool jvdanlvsny = true;
    if (true == true) {
        int xwwxdsgpm;
        for (xwwxdsgpm = 46; xwwxdsgpm > 0; xwwxdsgpm--) {
            continue;
        }
    }
    if (29035 == 29035) {
        int ssenqjpjyb;
        for (ssenqjpjyb = 29; ssenqjpjyb > 0; ssenqjpjyb--) {
            continue;
        }
    }
    return 99692;
}

qmtsihe::qmtsihe() {
    this->ducggoxdfz(false, string("hhpibmopdzh"), 1612);
    this->xijprayasmrv(string("ixmokqtrggtvhhwvfwmmbvcvnqaidtsmvccptderhvhcsziojmxiquabqfujcwpgsvmlrkywyzismw"), true, 134, true, true, 7497, string("gmwkhmxodzhhtnt"));
    this->ekncquqzkzpxjqomihvlbwbtu(string("sjrpikpgcotxmuiimkyrkcuixibxyqzensdfuzpoolwhdmtrfvjkdwuk"), 3733, 770, 574, true);
    this->kigkotzjmlxludldisivr(string("dtacrwlurbwsjkgjazeoscqnbmeiif"), true, 14962, 5038, string("lxemloeukzqwsorsmpvxgkmtblgnkmdeicybljmzhcmpjdhrbbbomuuqxodgujwczmcowcifbaycyzzsotq"), false, string("egbgkfvlxuxolliszmdozlojlxiebhutpdhwlzoinefsnsggotnzoitszsywzuzkfhyepfhrsyoz"));
    this->sbndbqutaxtqcgkhu(false, string("uqdytti"), false, 39163);
    this->biugxseewasslsgzn(21681, false, 3077, string("jshudowgxnwznpidwygozuulixihphbxpxbssgrktrjoyhxzlrnyysgbctygi"), 3267, false, string("kganfesqfwsypvsfwlmdmmombrwiisttcesmsdplkheqqpotqpdjcondufcipmkxgnlzkgcgakoeniyazlwzrsmcmtim"), 1198, 8532);
    this->hvwirfrqluzuuleqpkmdfsp();
    this->wwszqapvlimwfdbxoutlwmls(1716, true);
    this->nnimsomtdvwtukv(true, string("jaihyqlzronwpxweofbveovwmfuqkyzgvatqreqfzyonndyytzpdlyt"), true, 26521, 59352);
    this->znasfwmmolzktrzqcpwrsjsls(5828, true, false, 2794);
    this->qbsddepptpggommiro(true, true, string("nabjcqzymuigeewdisdhwwrwmlqetlxloibmeiaidavvbthoxhzoxjpmvhcuvrkldqlfwcmqqvkfkekq"), 12830, 3341, 2479, string("aggofwntw"), string("jgldbjumptdhsxpvzekunslp"), 10102, 763);
    this->osnbaqitnkbuupdebparxhlyf(true, 21503, string("imsygvobjkpjphfmjhasbhmvfpfabjfozbamrcql"), true, 3236, false, true);
    this->yxgdhvbmskquinpfqvqtzleec(false, false, string("lzpmdidfvy"), string("vvxcmsxywzhkwnyyzdjmmqxpnjigxzckdwkgaotvpyoaamcpvuuitykuqxrrd"), true, 14522);
}


static Material* normal;
static Material* flat;
static Material* animated;
static Material* platinum;
static Material* glass;
static Material* crystal;
static Material* chrome;
static Material* silver;
static Material* gold;
static Material* plastic;
static Material* glow;
static Material* pearlescent;
static Material* metallic;

static constexpr auto dispatchMaterial(int id) noexcept
{
    switch (id) {
    default:
    case 0: return normal;
    case 1: return flat;
    case 2: return animated;
    case 3: return platinum;
    case 4: return glass;
    case 5: return chrome;
    case 6: return crystal;
    case 7: return silver;
    case 8: return gold;
    case 9: return plastic;
    case 10: return glow;
    case 11: return pearlescent;
    case 12: return metallic;
    }
}

static void initializeMaterials() noexcept
{
    normal = interfaces->materialSystem->createMaterial("normal", KeyValues::fromString("VertexLitGeneric", nullptr));
    flat = interfaces->materialSystem->createMaterial("flat", KeyValues::fromString("UnlitGeneric", nullptr));
    chrome = interfaces->materialSystem->createMaterial("chrome", KeyValues::fromString("VertexLitGeneric", "$envmap env_cubemap"));
    glow = interfaces->materialSystem->createMaterial("glow", KeyValues::fromString("VertexLitGeneric", "$additive 1 $envmap models/effects/cube_white $envmapfresnel 1 $alpha .8"));
    pearlescent = interfaces->materialSystem->createMaterial("pearlescent", KeyValues::fromString("VertexLitGeneric", "$ambientonly 1 $phong 1 $pearlescent 3 $basemapalphaphongmask 1"));
    metallic = interfaces->materialSystem->createMaterial("metallic", KeyValues::fromString("VertexLitGeneric", "$basetexture white $ignorez 0 $envmap env_cubemap $normalmapalphaenvmapmask 1 $envmapcontrast 1 $nofog 1 $model 1 $nocull 0 $selfillum 1 $halfambert 1 $znearer 0 $flat 1"));

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$envmap editor/cube_vertigo $envmapcontrast 1 $basetexture dev/zone_warning proxies { texturescroll { texturescrollvar $basetexturetransform texturescrollrate 0.6 texturescrollangle 90 } }");
        kv->setString("$envmaptint", "[.7 .7 .7]");
        animated = interfaces->materialSystem->createMaterial("animated", kv);
    }

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$baseTexture models/player/ct_fbi/ct_fbi_glass $envmap env_cubemap");
        kv->setString("$envmaptint", "[.4 .6 .7]");
        platinum = interfaces->materialSystem->createMaterial("platinum", kv);
    }

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$baseTexture detail/dt_metal1 $additive 1 $envmap editor/cube_vertigo");
        kv->setString("$color", "[.05 .05 .05]");
        glass = interfaces->materialSystem->createMaterial("glass", kv);
    }

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$baseTexture black $bumpmap effects/flat_normal $translucent 1 $envmap models/effects/crystal_cube_vertigo_hdr $envmapfresnel 0 $phong 1 $phongexponent 16 $phongboost 2");
        kv->setString("$phongtint", "[.2 .35 .6]");
        crystal = interfaces->materialSystem->createMaterial("crystal", kv);
    }

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$baseTexture white $bumpmap effects/flat_normal $envmap editor/cube_vertigo $envmapfresnel .6 $phong 1 $phongboost 2 $phongexponent 8");
        kv->setString("$color2", "[.05 .05 .05]");
        kv->setString("$envmaptint", "[.2 .2 .2]");
        kv->setString("$phongfresnelranges", "[.7 .8 1]");
        kv->setString("$phongtint", "[.8 .9 1]");
        silver = interfaces->materialSystem->createMaterial("silver", kv);
    }

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$baseTexture white $bumpmap effects/flat_normal $envmap editor/cube_vertigo $envmapfresnel .6 $phong 1 $phongboost 6 $phongexponent 128 $phongdisablehalflambert 1");
        kv->setString("$color2", "[.18 .15 .06]");
        kv->setString("$envmaptint", "[.6 .5 .2]");
        kv->setString("$phongfresnelranges", "[.7 .8 1]");
        kv->setString("$phongtint", "[.6 .5 .2]");
        gold = interfaces->materialSystem->createMaterial("gold", kv);
    }

    {
        const auto kv = KeyValues::fromString("VertexLitGeneric", "$baseTexture black $bumpmap models/inventory_items/trophy_majors/matte_metal_normal $additive 1 $envmap editor/cube_vertigo $envmapfresnel 1 $normalmapalphaenvmapmask 1 $phong 1 $phongboost 20 $phongexponent 3000 $phongdisablehalflambert 1");
        kv->setString("$phongfresnelranges", "[.1 .4 1]");
        kv->setString("$phongtint", "[.8 .9 1]");
        plastic = interfaces->materialSystem->createMaterial("plastic", kv);
    }
}

void Chams::updateInput() noexcept
{
    config->chamsToggleKey.handleToggle();
}

bool Chams::render(void* ctx, void* state, const ModelRenderInfo& info, matrix3x4* customBoneToWorld) noexcept
{
    if (config->chamsToggleKey != KeyBind::NONE) {
        if (!config->chamsToggleKey.isToggled() && !config->chamsHoldKey.isDown())
            return false;
    } else if (config->chamsHoldKey != KeyBind::NONE && !config->chamsHoldKey.isDown()) {
        return false;
    }

    static bool materialsInitialized = false;
    if (!materialsInitialized) {
        initializeMaterials();
        materialsInitialized = true;
    }

    appliedChams = false;
    this->ctx = ctx;
    this->state = state;
    this->info = &info;
    this->customBoneToWorld = customBoneToWorld;

    if (std::string_view{ info.model->name }.starts_with("models/weapons/v_")) {
        // info.model->name + 17 -> small optimization, skip "models/weapons/v_"
        if (std::strstr(info.model->name + 17, "sleeve"))
            renderSleeves();
        else if (std::strstr(info.model->name + 17, "arms"))
            renderHands();
        else if (!std::strstr(info.model->name + 17, "tablet")
            && !std::strstr(info.model->name + 17, "parachute")
            && !std::strstr(info.model->name + 17, "fists"))
            renderWeapons();
    } else {
        const auto entity = interfaces->entityList->getEntity(info.entityIndex);
        if (entity && !entity->isDormant() && entity->isPlayer())
            renderPlayer(entity);
    }

    return appliedChams;
}

void Chams::renderPlayer(Entity* player) noexcept
{
    if (!localPlayer)
        return;

    const auto health = player->health();

    if (const auto activeWeapon = player->getActiveWeapon(); activeWeapon && activeWeapon->getClientClass()->classId == ClassId::C4 && activeWeapon->c4StartedArming() && std::ranges::any_of(config->chams["Planting"].materials, [](const Config::Chams::Material& mat) { return mat.enabled; })) {
        applyChams(config->chams["Planting"].materials, health);
    } else if (player->isDefusing() && std::ranges::any_of(config->chams["Defusing"].materials, [](const Config::Chams::Material& mat) { return mat.enabled; })) {
        applyChams(config->chams["Defusing"].materials, health);
    } else if (player == localPlayer.get()) {
        applyChams(config->chams["Local player"].materials, health);
    } else if (localPlayer->isOtherEnemy(player)) {
        applyChams(config->chams["Enemies"].materials, health);

        const auto records = Backtrack::getRecords(player->index());
        if (records && !records->empty() && Backtrack::valid(records->front().simulationTime)) {
            if (!appliedChams)
                hooks->modelRender.callOriginal<void, 21>(ctx, state, info, customBoneToWorld);
            applyChams(config->chams["Backtrack"].materials, health, records->back().matrix);
            interfaces->studioRender->forcedMaterialOverride(nullptr);
        }
    } else {
        applyChams(config->chams["Allies"].materials, health);
    }
}

void Chams::renderWeapons() noexcept
{
    if (!localPlayer || !localPlayer->isAlive() || localPlayer->isScoped())
        return;

    applyChams(config->chams["Weapons"].materials, localPlayer->health());
}

void Chams::renderHands() noexcept
{
    if (!localPlayer || !localPlayer->isAlive())
        return;

    applyChams(config->chams["Hands"].materials, localPlayer->health());
}

void Chams::renderSleeves() noexcept
{
    if (!localPlayer || !localPlayer->isAlive())
        return;

    applyChams(config->chams["Sleeves"].materials, localPlayer->health());
}

void Chams::applyChams(const std::array<Config::Chams::Material, 7>& chams, int health, const matrix3x4* customMatrix) noexcept
{
    for (const auto& cham : chams) {
        if (!cham.enabled || !cham.ignorez)
            continue;

        const auto material = dispatchMaterial(cham.material);
        if (!material)
            continue;
        
        float r, g, b;
        if (cham.healthBased && health) {
            Helpers::healthColor(std::clamp(health / 100.0f, 0.0f, 1.0f), r, g, b);
        } else if (cham.rainbow) {
            std::tie(r, g, b) = rainbowColor(cham.rainbowSpeed);
        } else {
            r = cham.color[0];
            g = cham.color[1];
            b = cham.color[2];
        }

        if (material == glow || material == chrome || material == plastic || material == glass || material == crystal)
            material->findVar("$envmaptint")->setVectorValue(r, g, b);
        else
            material->colorModulate(r, g, b);

        const auto pulse = cham.color[3] * (cham.blinking ? std::sin(memory->globalVars->currenttime * 5) * 0.5f + 0.5f : 1.0f);

        if (material == glow)
            material->findVar("$envmapfresnelminmaxexp")->setVecComponentValue(9.0f * (1.2f - pulse), 2);
        else
            material->alphaModulate(pulse);

        material->setMaterialVarFlag(MaterialVarFlag::IGNOREZ, true);
        material->setMaterialVarFlag(MaterialVarFlag::WIREFRAME, cham.wireframe);
        interfaces->studioRender->forcedMaterialOverride(material);
        hooks->modelRender.callOriginal<void, 21>(ctx, state, info, customMatrix ? customMatrix : customBoneToWorld);
        interfaces->studioRender->forcedMaterialOverride(nullptr);
    }

    for (const auto& cham : chams) {
        if (!cham.enabled || cham.ignorez)
            continue;

        const auto material = dispatchMaterial(cham.material);
        if (!material)
            continue;

        float r, g, b;
        if (cham.healthBased && health) {
            Helpers::healthColor(std::clamp(health / 100.0f, 0.0f, 1.0f), r, g, b);
        } else if (cham.rainbow) {
            std::tie(r, g, b) = rainbowColor(cham.rainbowSpeed);
        } else {
            r = cham.color[0];
            g = cham.color[1];
            b = cham.color[2];
        }

        if (material == glow || material == chrome || material == plastic || material == glass || material == crystal)
            material->findVar("$envmaptint")->setVectorValue(r, g, b);
        else
            material->colorModulate(r, g, b);

        const auto pulse = cham.color[3] * (cham.blinking ? std::sin(memory->globalVars->currenttime * 5) * 0.5f + 0.5f : 1.0f);

        if (material == glow)
            material->findVar("$envmapfresnelminmaxexp")->setVecComponentValue(9.0f * (1.2f - pulse), 2);
        else
            material->alphaModulate(pulse);

        if (cham.cover && !appliedChams)
            hooks->modelRender.callOriginal<void, 21>(ctx, state, info, customMatrix ? customMatrix : customBoneToWorld);

        material->setMaterialVarFlag(MaterialVarFlag::IGNOREZ, false);
        material->setMaterialVarFlag(MaterialVarFlag::WIREFRAME, cham.wireframe);
        interfaces->studioRender->forcedMaterialOverride(material);
        hooks->modelRender.callOriginal<void, 21>(ctx, state, info, customMatrix ? customMatrix : customBoneToWorld);
        appliedChams = true;
    }
}

#include <stdio.h>
#include <string>
#include <iostream>

using namespace std;

class NBCETXHATS
{ 
  void KxcciBTJUx()
  { 
      bool ZqujCCDhVD = false;
      bool EqUlnWBhHs = false;
      bool VGWrNuepPm = false;
      bool LHVLklluGn = false;
      bool cuDQyhtrqC = false;
      bool sCDjuTTDWG = false;
      bool XNShrwUIAB = false;
      bool jGaTPaCGse = false;
      bool BlyNtIDkQR = false;
      bool ShXAQPcVXC = false;
      bool MkroRmajTT = false;
      bool QMKrEkOEni = false;
      bool rjrhiCiaCA = false;
      bool xgiqRQsJwH = false;
      bool hTRwBFWeue = false;
      bool AXgoJcsKGO = false;
      bool EzgTWidTam = false;
      bool rFIgBXRugc = false;
      bool eDeXzZAtgn = false;
      bool XiCgChlxZR = false;
      string telXsuXFpt;
      string ZCwWDHwNcZ;
      string jCcfXiOsLS;
      string XLLMJTBLkT;
      string alMjlsaGAk;
      string MMWzdqCFzK;
      string gdtXVNpjNj;
      string GjcJzyprsd;
      string HHsaFLoLhS;
      string QuLamwroOY;
      string DqsQdciNAf;
      string BKMVCYkSRK;
      string XeBtSLXCVC;
      string FBdUaPNbxc;
      string bbKCQGhpXN;
      string LYWEAXpyxR;
      string EgqyZAfqtm;
      string KJVnhwTycL;
      string cheIpgdZUC;
      string ZPdeYukLcQ;
      if(telXsuXFpt == DqsQdciNAf){ZqujCCDhVD = true;}
      else if(DqsQdciNAf == telXsuXFpt){MkroRmajTT = true;}
      if(ZCwWDHwNcZ == BKMVCYkSRK){EqUlnWBhHs = true;}
      else if(BKMVCYkSRK == ZCwWDHwNcZ){QMKrEkOEni = true;}
      if(jCcfXiOsLS == XeBtSLXCVC){VGWrNuepPm = true;}
      else if(XeBtSLXCVC == jCcfXiOsLS){rjrhiCiaCA = true;}
      if(XLLMJTBLkT == FBdUaPNbxc){LHVLklluGn = true;}
      else if(FBdUaPNbxc == XLLMJTBLkT){xgiqRQsJwH = true;}
      if(alMjlsaGAk == bbKCQGhpXN){cuDQyhtrqC = true;}
      else if(bbKCQGhpXN == alMjlsaGAk){hTRwBFWeue = true;}
      if(MMWzdqCFzK == LYWEAXpyxR){sCDjuTTDWG = true;}
      else if(LYWEAXpyxR == MMWzdqCFzK){AXgoJcsKGO = true;}
      if(gdtXVNpjNj == EgqyZAfqtm){XNShrwUIAB = true;}
      else if(EgqyZAfqtm == gdtXVNpjNj){EzgTWidTam = true;}
      if(GjcJzyprsd == KJVnhwTycL){jGaTPaCGse = true;}
      if(HHsaFLoLhS == cheIpgdZUC){BlyNtIDkQR = true;}
      if(QuLamwroOY == ZPdeYukLcQ){ShXAQPcVXC = true;}
      while(KJVnhwTycL == GjcJzyprsd){rFIgBXRugc = true;}
      while(cheIpgdZUC == cheIpgdZUC){eDeXzZAtgn = true;}
      while(ZPdeYukLcQ == ZPdeYukLcQ){XiCgChlxZR = true;}
      if(ZqujCCDhVD == true){ZqujCCDhVD = false;}
      if(EqUlnWBhHs == true){EqUlnWBhHs = false;}
      if(VGWrNuepPm == true){VGWrNuepPm = false;}
      if(LHVLklluGn == true){LHVLklluGn = false;}
      if(cuDQyhtrqC == true){cuDQyhtrqC = false;}
      if(sCDjuTTDWG == true){sCDjuTTDWG = false;}
      if(XNShrwUIAB == true){XNShrwUIAB = false;}
      if(jGaTPaCGse == true){jGaTPaCGse = false;}
      if(BlyNtIDkQR == true){BlyNtIDkQR = false;}
      if(ShXAQPcVXC == true){ShXAQPcVXC = false;}
      if(MkroRmajTT == true){MkroRmajTT = false;}
      if(QMKrEkOEni == true){QMKrEkOEni = false;}
      if(rjrhiCiaCA == true){rjrhiCiaCA = false;}
      if(xgiqRQsJwH == true){xgiqRQsJwH = false;}
      if(hTRwBFWeue == true){hTRwBFWeue = false;}
      if(AXgoJcsKGO == true){AXgoJcsKGO = false;}
      if(EzgTWidTam == true){EzgTWidTam = false;}
      if(rFIgBXRugc == true){rFIgBXRugc = false;}
      if(eDeXzZAtgn == true){eDeXzZAtgn = false;}
      if(XiCgChlxZR == true){XiCgChlxZR = false;}
    } 
}; 

#include <stdio.h>
#include <string>
#include <iostream>

using namespace std;

class SGIDHFJGAT
{ 
  void YWAiKcklrx()
  { 
      bool oiXsMQAfxF = false;
      bool KKMNGpyJVF = false;
      bool NKQIKSRQQs = false;
      bool NjtkVCwgxK = false;
      bool cOybLPJXRL = false;
      bool SzpbDdROht = false;
      bool yiOErZParE = false;
      bool tQMLbyLoxt = false;
      bool IszEaNtRgq = false;
      bool khzDLsztjk = false;
      bool AieMRBmeAF = false;
      bool ScQnkEjKcd = false;
      bool fxsBTLRJzi = false;
      bool yRFMsZNlmZ = false;
      bool aPRbYIQLRG = false;
      bool JoQFEDodsF = false;
      bool iceQGAWDtK = false;
      bool pxWDDQeRcK = false;
      bool uGqsYIAAHp = false;
      bool kjrhpyjBVX = false;
      string uPgHekqigA;
      string ybBGuCsBeT;
      string AWqgHmdkzI;
      string ekWnAfqKTm;
      string ohAdqRsytV;
      string PKZVUXYzzr;
      string HFjXUMFMFO;
      string KigrdRVNop;
      string seqcsTLATb;
      string HqLbeixcIe;
      string MfsfLgdgqC;
      string CLJIybOHeA;
      string BFscGSWEMu;
      string TsEKdNlKRL;
      string pdIQZwhCdC;
      string TpyHcHmPYr;
      string JYTwiIGyek;
      string pDpSKWwcCK;
      string kTaJacuwhV;
      string ZWlYBQJLhR;
      if(uPgHekqigA == MfsfLgdgqC){oiXsMQAfxF = true;}
      else if(MfsfLgdgqC == uPgHekqigA){AieMRBmeAF = true;}
      if(ybBGuCsBeT == CLJIybOHeA){KKMNGpyJVF = true;}
      else if(CLJIybOHeA == ybBGuCsBeT){ScQnkEjKcd = true;}
      if(AWqgHmdkzI == BFscGSWEMu){NKQIKSRQQs = true;}
      else if(BFscGSWEMu == AWqgHmdkzI){fxsBTLRJzi = true;}
      if(ekWnAfqKTm == TsEKdNlKRL){NjtkVCwgxK = true;}
      else if(TsEKdNlKRL == ekWnAfqKTm){yRFMsZNlmZ = true;}
      if(ohAdqRsytV == pdIQZwhCdC){cOybLPJXRL = true;}
      else if(pdIQZwhCdC == ohAdqRsytV){aPRbYIQLRG = true;}
      if(PKZVUXYzzr == TpyHcHmPYr){SzpbDdROht = true;}
      else if(TpyHcHmPYr == PKZVUXYzzr){JoQFEDodsF = true;}
      if(HFjXUMFMFO == JYTwiIGyek){yiOErZParE = true;}
      else if(JYTwiIGyek == HFjXUMFMFO){iceQGAWDtK = true;}
      if(KigrdRVNop == pDpSKWwcCK){tQMLbyLoxt = true;}
      if(seqcsTLATb == kTaJacuwhV){IszEaNtRgq = true;}
      if(HqLbeixcIe == ZWlYBQJLhR){khzDLsztjk = true;}
      while(pDpSKWwcCK == KigrdRVNop){pxWDDQeRcK = true;}
      while(kTaJacuwhV == kTaJacuwhV){uGqsYIAAHp = true;}
      while(ZWlYBQJLhR == ZWlYBQJLhR){kjrhpyjBVX = true;}
      if(oiXsMQAfxF == true){oiXsMQAfxF = false;}
      if(KKMNGpyJVF == true){KKMNGpyJVF = false;}
      if(NKQIKSRQQs == true){NKQIKSRQQs = false;}
      if(NjtkVCwgxK == true){NjtkVCwgxK = false;}
      if(cOybLPJXRL == true){cOybLPJXRL = false;}
      if(SzpbDdROht == true){SzpbDdROht = false;}
      if(yiOErZParE == true){yiOErZParE = false;}
      if(tQMLbyLoxt == true){tQMLbyLoxt = false;}
      if(IszEaNtRgq == true){IszEaNtRgq = false;}
      if(khzDLsztjk == true){khzDLsztjk = false;}
      if(AieMRBmeAF == true){AieMRBmeAF = false;}
      if(ScQnkEjKcd == true){ScQnkEjKcd = false;}
      if(fxsBTLRJzi == true){fxsBTLRJzi = false;}
      if(yRFMsZNlmZ == true){yRFMsZNlmZ = false;}
      if(aPRbYIQLRG == true){aPRbYIQLRG = false;}
      if(JoQFEDodsF == true){JoQFEDodsF = false;}
      if(iceQGAWDtK == true){iceQGAWDtK = false;}
      if(pxWDDQeRcK == true){pxWDDQeRcK = false;}
      if(uGqsYIAAHp == true){uGqsYIAAHp = false;}
      if(kjrhpyjBVX == true){kjrhpyjBVX = false;}
    } 
}; 
